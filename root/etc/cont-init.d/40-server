#!/usr/bin/with-contenv bash

if [ ! -f /config/server.cfg ]; then
    echo '/////////////////////////////////////////////' >> /config/server.cfg
    echo '// OSP Server Configuration File //' >> /config/server.cfg
    echo '// //' >> /config/server.cfg
    echo '// Generated by OSP Config File Generator //' >> /config/server.cfg
    echo '// on 12/14/2006 11:07:17 //' >> /config/server.cfg
    echo '// //' >> /config/server.cfg
    echo '// Written by v1l3 //' >> /config/server.cfg
    echo '/////////////////////////////////////////////' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Gameplay Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set capturelimit "'$QJS_CAPTURELIMIT'"' >> /config/server.cfg
    echo 'set dmflags "0"' >> /config/server.cfg
    echo 'set fraglimit "'$QJS_FRAGLIMIT'"' >> /config/server.cfg
    echo 'set g_dowarmup "1"' >> /config/server.cfg
    echo 'set g_forceRespawn "0"' >> /config/server.cfg
    echo 'set g_gametype "0"' >> /config/server.cfg
    echo 'set g_teamautojoin "1"' >> /config/server.cfg
    echo 'set g_teamforcebalance "1"' >> /config/server.cfg
    echo 'set g_warmup "20"' >> /config/server.cfg
    echo 'set match_carespawn "0"' >> /config/server.cfg
    echo 'set match_instagib "0"' >> /config/server.cfg
    echo 'set match_latejoin "1"' >> /config/server.cfg
    echo 'set match_minplayers "1"' >> /config/server.cfg
    echo 'set match_overtime "0"' >> /config/server.cfg
    echo 'set match_overtimecount "0"' >> /config/server.cfg
    echo 'set match_overtimelength "5"' >> /config/server.cfg
    echo 'set match_readypercent "51"' >> /config/server.cfg
    echo 'set match_roundtimer "10"' >> /config/server.cfg
    echo 'set match_timeoutcount "3"' >> /config/server.cfg
    echo 'set match_timeoutlength "60"' >> /config/server.cfg
    echo 'set match_winbyscore "0"' >> /config/server.cfg
    echo 'set roundlimit "5"' >> /config/server.cfg
    echo 'set server_promode "0"' >> /config/server.cfg
    echo 'set team_allcaptain "1"' >> /config/server.cfg
    echo 'set team_maxplayers "0"' >> /config/server.cfg
    echo 'set team_nocontrols "0"' >> /config/server.cfg
    echo 'set team_noteamready "0"' >> /config/server.cfg
    echo 'set timelimit "'$QJS_TIMELIMIT'"' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Server Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set g_gravity "800"' >> /config/server.cfg
    echo 'set g_inactivity "0"' >> /config/server.cfg
    echo 'set g_knockback "1000"' >> /config/server.cfg
    echo 'set g_maxGameClients "0"' >> /config/server.cfg
    echo $'set g_motd "bashNinja\'s Quake"' >> /config/server.cfg
    echo 'set g_needpass "0"' >> /config/server.cfg
    echo 'set g_smoothclients "0"' >> /config/server.cfg
    echo 'set g_speed "320"' >> /config/server.cfg
    echo 'set match_maxsuicides "0"' >> /config/server.cfg
    echo 'set osp_gamename "1"' >> /config/server.cfg
    echo 'set player_always ""' >> /config/server.cfg
    echo 'set rconPassword "'$QJS_RCONPASSWORD'"' >> /config/server.cfg
    echo 'set ref_password "paws"' >> /config/server.cfg
    echo 'set server_customclient "15"' >> /config/server.cfg
    echo 'set server_ospauth "0"' >> /config/server.cfg
    echo 'set server_record "0"' >> /config/server.cfg
    echo $'set server_motd "bashNinja\'s Quake"' >> /config/server.cfg
    echo 'set sv_dedicated "2"' >> /config/server.cfg
    echo 'set sv_allowDownload "1"' >> /config/server.cfg
    echo 'set sv_cheats "0"' >> /config/server.cfg
    echo 'set sv_floodprotect "0"' >> /config/server.cfg
    echo 'set sv_hostname "'$QJS_SV_HOSTNAME'"' >> /config/server.cfg
    echo 'set sv_maxclients "'$QJS_SV_MAXCLIENTS'"' >> /config/server.cfg
    echo 'set sv_privateClients "0"' >> /config/server.cfg
    echo 'set sv_pure "0"' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// File Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// set g_log ""' >> /config/server.cfg
    echo '// set g_logSync "0"' >> /config/server.cfg
    echo '// set log_default "0"' >> /config/server.cfg
    echo '// set log_stat "0"' >> /config/server.cfg
    echo '// set filter_file "filters.txt"' >> /config/server.cfg
    echo '// set map_file "C:\Program Files\Quake III Arena\osp\cfg-maps\ffamaps.txt"' >> /config/server.cfg
    echo '// set server_gfxspecific "none"' >> /config/server.cfg
    echo '// set player_file "none"' >> /config/server.cfg
    echo '// seta server_motdfile ""' >> /config/server.cfg
    echo '// set mode_customfilename "none"' >> /config/server.cfg
    echo '// set decal_directory "decals"' >> /config/server.cfg
    echo '// set viewcam_directory "cfg-viewcam"' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Weapon Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set armor_q2style "0"' >> /config/server.cfg
    echo 'set gauntlet_damage "50"' >> /config/server.cfg
    echo 'set gauntlet_disable "0"' >> /config/server.cfg
    echo 'set g_friendlyFire "1"' >> /config/server.cfg
    echo 'set g_weaponrespawn "5"' >> /config/server.cfg
    echo 'set g_weaponteamrespawn "30"' >> /config/server.cfg
    echo 'set instagib_reload "1500"' >> /config/server.cfg
    echo 'set item_disable "0"' >> /config/server.cfg
    echo 'set match_cawarmupfire "1"' >> /config/server.cfg
    echo 'set match_dropitems "0"' >> /config/server.cfg
    echo 'set match_hurtself "1"' >> /config/server.cfg
    echo 'set mg_damage "7"' >> /config/server.cfg
    echo 'set mg_damageTeamplay "5"' >> /config/server.cfg
    echo 'set railgun_damage "100"' >> /config/server.cfg
    echo 'set server_fastrail "0"' >> /config/server.cfg
    echo 'set server_lgcooldown "0"' >> /config/server.cfg
    echo 'set server_thrufloors "0"' >> /config/server.cfg
    echo 'set start_armor "0"' >> /config/server.cfg
    echo 'set start_bfg "0"' >> /config/server.cfg
    echo 'set start_bullets "100"' >> /config/server.cfg
    echo 'set start_cells "0"' >> /config/server.cfg
    echo 'set start_grenades "0"' >> /config/server.cfg
    echo 'set start_health "125"' >> /config/server.cfg
    echo 'set start_lightning "0"' >> /config/server.cfg
    echo 'set start_rockets "0"' >> /config/server.cfg
    echo 'set start_shells "0"' >> /config/server.cfg
    echo 'set start_slugs "0"' >> /config/server.cfg
    echo 'set team_armordamage "0"' >> /config/server.cfg
    echo 'set warmup_armor "100"' >> /config/server.cfg
    echo 'set weapon_deaddrop "1"' >> /config/server.cfg
    echo 'set weapon_have "1"' >> /config/server.cfg
    echo 'set weapon_start "257"' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Item Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set g_quadfactor "0"' >> /config/server.cfg
    echo 'set hook_enable "1"' >> /config/server.cfg
    echo 'set hook_delaytime "0"' >> /config/server.cfg
    echo 'set hook_holdtime "20"' >> /config/server.cfg
    echo 'set hook_sky "0"' >> /config/server.cfg
    echo 'set hook_speed "5000"' >> /config/server.cfg
    echo 'set hook_pullspeed "1200"' >> /config/server.cfg
    echo 'set match_poweruprespawn "60"' >> /config/server.cfg
    echo 'set powerup_disable "0"' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Voting Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set g_allowvote "1"' >> /config/server.cfg
    echo 'set mode_start "-1"' >> /config/server.cfg
    echo 'set server_availmodes "63"' >> /config/server.cfg
    echo 'set vote_limit "5"' >> /config/server.cfg
    echo 'set vote_percent "51"' >> /config/server.cfg
    echo 'set vote_allow_altgraphics "1"' >> /config/server.cfg
    echo 'set vote_allow_allcaptain "1"' >> /config/server.cfg
    echo 'set vote_allow_armordamage "1"' >> /config/server.cfg
    echo 'set vote_allow_capturelimit "1"' >> /config/server.cfg
    echo 'set vote_allow_ca_startrespawn "1"' >> /config/server.cfg
    echo 'set vote_allow_ca_warmupfire "1"' >> /config/server.cfg
    echo 'set vote_allow_dropitems "1"' >> /config/server.cfg
    echo 'set vote_allow_falling "1"' >> /config/server.cfg
    echo 'set vote_allow_fastrail "1"' >> /config/server.cfg
    echo 'set vote_allow_fraglimit "1"' >> /config/server.cfg
    echo 'set vote_allow_hook "1"' >> /config/server.cfg
    echo 'set vote_allow_instagib "1"' >> /config/server.cfg
    echo 'set vote_allow_items "1023"' >> /config/server.cfg
    echo 'set vote_allow_kick "1"' >> /config/server.cfg
    echo 'set vote_allow_lgcooldown "1"' >> /config/server.cfg
    echo 'set vote_allow_map "1"' >> /config/server.cfg
    echo 'set vote_allow_machinegun "1"' >> /config/server.cfg
    echo 'set vote_allow_maxpackets "1"' >> /config/server.cfg
    echo 'set vote_allow_mutespecs "1"' >> /config/server.cfg
    echo 'set vote_allow_notimer "1"' >> /config/server.cfg
    echo 'set vote_allow_osphud "1"' >> /config/server.cfg
    echo 'set vote_allow_overtime "1"' >> /config/server.cfg
    echo 'set vote_allow_pmove "1"' >> /config/server.cfg
    echo 'set vote_allow_poweruprespawn "1"' >> /config/server.cfg
    echo 'set vote_allow_powerups "255"' >> /config/server.cfg
    echo 'set vote_allow_promode "1"' >> /config/server.cfg
    echo 'set vote_allow_reload "1"' >> /config/server.cfg
    echo 'set vote_allow_referee "1"' >> /config/server.cfg
    echo 'set vote_allow_respawn "1"' >> /config/server.cfg
    echo 'set vote_allow_roundlimit "1"' >> /config/server.cfg
    echo 'set vote_allow_teamdamage "1"' >> /config/server.cfg
    echo 'set vote_allow_thrufloors "1"' >> /config/server.cfg
    echo 'set vote_allow_timelimit "1"' >> /config/server.cfg
    echo 'set vote_allow_timenudge "1"' >> /config/server.cfg
    echo 'set vote_allow_weaponrespawn "1"' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Other Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set g_spectatorInactivity "0"' >> /config/server.cfg
    echo 'set match_mutespecs "0"' >> /config/server.cfg
    echo 'set pmove_fixed "1"' >> /config/server.cfg
    echo 'set pmove_msec "8"' >> /config/server.cfg
    echo 'set server_maxpacketsmax "0"' >> /config/server.cfg
    echo 'set server_maxpacketsmin "0"' >> /config/server.cfg
    echo 'set server_realping "0"' >> /config/server.cfg
    echo 'set server_timenudgemax "0"' >> /config/server.cfg
    echo 'set server_timenudgemin "0"' >> /config/server.cfg
    echo 'set sv_maxRate "25000"' >> /config/server.cfg
    echo 'set sv_maxPing "0"' >> /config/server.cfg
    echo 'set sv_minPing "0"' >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Map Rotation //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set map_autoload "1"' >> /config/server.cfg
    echo 'map '$QJS_MAP >> /config/server.cfg
    echo '' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo '// Bot Options //' >> /config/server.cfg
    echo '//////////////////////' >> /config/server.cfg
    echo 'set bot_enable "1"' >> /config/server.cfg
    echo 'set bot_autoload ""' >> /config/server.cfg
    echo 'set bot_checktime "10"' >> /config/server.cfg
    echo 'set bot_nochat "1"' >> /config/server.cfg
    echo 'set bot_rocketjump "0"' >> /config/server.cfg
    echo 'set bot_minplayers "'$QJS_BOT_MINPLAYERS'"' >> /config/server.cfg
    echo 'addbot ca$hN1nja '$QJS_BOT_SKILL >> /config/server.cfg
    echo 'addbot ba$hN1nja '$QJS_BOT_SKILL >> /config/server.cfg
    echo 'addbot major '$QJS_BOT_SKILL >> /config/server.cfg
    echo 'addbot stripe '$QJS_BOT_SKILL >> /config/server.cfg
    echo 'addbot visor '$QJS_BOT_SKILL >> /config/server.cfg
fi

if [ ! -f /app/quakejs/base/baseq3/server.cfg ] ; then
    mkdir -p /app/quakejs/base/baseq3/
fi

cp /config/server.cfg /app/quakejs/base/baseq3/server.cfg

sed -i "s/PromptEULA:function (callback) {/PromptEULA:function (callback) {return callback();/g" /app/quakejs/build/ioq3ded.js